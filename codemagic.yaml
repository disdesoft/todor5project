workflows:
  ios:
    name: Build iOS
    max_build_duration: 60
    environment:
      flutter: stable
      xcode: 16.1  
      node: latest  

    scripts:
      - name: Set up Flutter environment
        script: |
          flutter channel stable
          flutter upgrade
          flutter doctor

      - name: Install dependencies
        script: |
          # Instalar dependencias de Flutter
          flutter pub get
          
          # Instalar CocoaPods (asegurándonos de que la versión sea la correcta)
          gem install cocoapods
          pod repo update

          # Hacer una instalación de CocoaPods con el directorio adecuado
          cd ios
          pod install --repo-update --no-integrate --verbose

      - name: Build iOS release
        script: |
          # Compilar para iOS sin códigosignature (sin certificado de Apple)
          flutter build ios --release --no-codesign --verbose

      - name: Upload build artifact
        script: |
          # Subir el archivo generado a algún lugar, si es necesario
          mkdir -p $CM_BUILD_DIR/artifacts
          cp -r build/ios/iphoneos/*.ipa $CM_BUILD_DIR/artifacts/
